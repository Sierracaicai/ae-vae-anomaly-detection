# üîç AE-VAE Anomaly Detection

This project evaluates and compares anomaly detection approaches on network traffic data using:

- üß† Deep learning methods: Autoencoder (AE), Variational Autoencoder (VAE)
- üß™ Classical methods: Isolation Forest, One-Class SVM, Local Outlier Factor, Elliptic Envelope

> Built as a portfolio-grade, modular and reproducible data science project.

---

## üìÅ Project Structure

```
ae-vae-anomaly-detection/
‚îú‚îÄ‚îÄ images/                 # save all plots
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îî‚îÄ‚îÄ README.md           # Dataset Description
‚îú‚îÄ‚îÄ docs/
‚îÇ   ‚îú‚îÄ‚îÄ feature_review.md  
‚îÇ   ‚îú‚îÄ‚îÄ experiments/
‚îÇ   ‚îÇ     ‚îú‚îÄ‚îÄ ae_eval_report.md      
‚îÇ   ‚îÇ     ‚îú‚îÄ‚îÄ ae_depth_comparison_report.md
‚îÇ   ‚îÇ     ‚îú‚îÄ‚îÄ bottleneck_report.md
‚îÇ   ‚îÇ     ‚îú‚îÄ‚îÄ ae_activation_experiment.md
‚îÇ   ‚îÇ     ‚îú‚îÄ‚îÄ ae_mixed_loss_experiment.md
‚îÇ   ‚îÇ     ‚îú‚îÄ‚îÄ optimizer_experiment.md
‚îÇ   ‚îÇ     ‚îî‚îÄ‚îÄ thresholding_comparison.md
‚îÇ   ‚îú‚îÄ‚îÄ final_ae_experiment_report.md  
‚îÇ   ‚îú‚îÄ‚îÄ VAE_report.md       
‚îÇ   ‚îú‚îÄ‚îÄ AE_vs_Traditional_Report.md 
‚îÇ   ‚îî‚îÄ‚îÄ SHAP_Interpretability_Report.md 
‚îú‚îÄ‚îÄ notebooks/              # Jupyter notebooks by stage
‚îÇ   ‚îú‚îÄ‚îÄ 0_draft_experiments.ipynb 
‚îÇ   ‚îú‚îÄ‚îÄ 0_exploration_and_baseline.ipynb 
‚îÇ   ‚îú‚îÄ‚îÄ EDA.ipynb
‚îÇ   ‚îú‚îÄ‚îÄ Preprocess_and_TSNE.ipynb
‚îÇ   ‚îú‚îÄ‚îÄ AE_base_model.ipynb
‚îÇ   ‚îú‚îÄ‚îÄ experiments/
‚îÇ   ‚îÇ    ‚îú‚îÄ‚îÄ AE_Depth_Comparison.ipynb
‚îÇ   ‚îÇ    ‚îú‚îÄ‚îÄ Ae_Bottleneck_Experiment.ipynb
‚îÇ   ‚îÇ    ‚îú‚îÄ‚îÄ Ae_activation_Experiment.ipynb
‚îÇ   ‚îÇ    ‚îú‚îÄ‚îÄ ae_mixed_loss_experiment.ipynb
‚îÇ   ‚îÇ    ‚îú‚îÄ‚îÄ AE_optimizer_experiment.ipynb
‚îÇ   ‚îÇ    ‚îî‚îÄ‚îÄ AE_Adaptive_Thresholding_experiment.ipynb
‚îÇ   ‚îú‚îÄ‚îÄ VAE_model.ipynb
‚îÇ   ‚îú‚îÄ‚îÄ traditional_models_with_tuning.ipy
‚îÇ   ‚îî‚îÄ‚îÄ Shap_Interpretability.ipynb
‚îÇ   
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ utils/              # Reusable utility modules
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ load_data.py    # Load raw CSV with default column names
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ load_data.md
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ reduce_mem.py   # Downcast dtypes to reduce memory
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ reduce_mem.md
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ preprocess.py   # Full preprocessing pipeline
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ preprocess.md
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ eda_tools.py    # EDA plotting & statistics utilities
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ eda_tools.md
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tsne_vis.py     # t-SNE 2D projection tool
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tsne_vis.md
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ module_reload.py# Hot-reload Python modules in Colab
‚îÇ   ‚îî‚îÄ‚îÄmodels/
‚îÇ       ‚îú‚îÄ‚îÄ ae_model.py           
‚îÇ       ‚îú‚îÄ‚îÄ ae_model.md 
‚îÇ       ‚îú‚îÄ‚îÄ ae_evaluation.py   
‚îÇ       ‚îú‚îÄ‚îÄ ae_evaluation.md  
‚îÇ       ‚îú‚îÄ‚îÄ thresholding.py
‚îÇ       ‚îú‚îÄ‚îÄ vae_model.py
‚îÇ       ‚îú‚îÄ‚îÄ beta_vae_model.py
‚îÇ       ‚îî‚îÄ‚îÄ best_ae.h5    
‚îÇ
‚îú‚îÄ‚îÄ requirements.txt        # List required Python packages & version
‚îú‚îÄ‚îÄ .gitignore              # Exclude raw/processed data, env files
‚îî‚îÄ‚îÄ README.md               # Project overview & usage
```

---

## üìä Dataset

**UNSW-NB15** ‚Äî A modern labeled network intrusion detection dataset.

- 47 features + `attack_cat` + binary `label`
- Mixture of normal traffic and multiple attack types
- Sampling Strategy
  - Initial experiments: 1/10 data for fast testing
  - Final AE/VAE training: full cleaned dataset (~640,000 rows)
  - All models trained on normal samples only, tested on mixed samples
- See `data/README.md` for detailed download and preparation instructions
---


## üß∞ Core Modules

This project is organized into clear functional components to enhance reproducibility and modularity:

### üîß `src/utils/`
Utility scripts for preprocessing, EDA, dimensionality reduction:
- `preprocess.py`: data cleaning pipeline, encoding, scaling, feature reduction
- `load_data.py`: standardized CSV loading with optional dtype control
- `reduce_mem.py`: memory optimization for large CSVs
- `tsne_vis.py`: TSNE dimensionality reduction for visualization
- `eda_tools.py`: helper functions for EDA and summary stats

### ü§ñ `src/models/`
Core model definitions and training utilities:
- `ae_model.py`: AutoEncoder model builder (depth, activation, dropout adjustable)
- `vae_model.py`: VAE model builder 
- `beta_vae_model.py`: Œ≤-VAE implementation with KL tuning and warm-up
- `ae_evaluation.py`: evaluation utilities, visualizations, and reporting
- `thresholding.py`: percentile/F1 threshold strategies

Each model module is independently testable and documented inline.



## üìì Notebooks

All notebooks are stored in the [`notebooks/`](./notebooks) folder and organized for each stage:

| Notebook | Description |
|----------|-------------|
| `0_draft_experiments.ipynb` | The very first draft version of this project |
| `0_exploration_and_baseline.ipynb` | A more structured and organized version of the original baseline |
| `üî∫EDA.ipynb` | Exploratory data analysis, feature distribution, rare category check |
| `üî∫Preprocess_and_TSNE.ipynb` | Preprocessing pipeline, scaling, encoding, and latent space visualization |
| `üî∫AE_base_model.ipynb` | Shallow AE structure, training, loss curves, evaluation |
| `üî∫experiments/` | 6 controlled AE model experiments on depth, bottleneck size, activations, loss functions, optimizers, thresholds |
Each experiment is separately documented and reproducible.
| `üî∫VAE_model.ipynb` | VAE and Œ≤-VAE models with KL warm-up and visualization |
| `üî∫Shap_Interpretability.ipynb` | SHAP analysis for best AE model interpretability |
| `üî∫traditional_models_with_tuning.ipynb` | Baseline classical models: One-Class SVM, LOF, Isolation Forest, Elliptic Envelope and evaluation|
---

## üî¨ Models and Experiments

The goal is to design and evaluate anomaly detection models under a robust framework. Models evaluated include:

### ‚úÖ AutoEncoder (AE)

Try basic AE model first, then design 6 experiments below to refine it
- Shallow & Deep AE comparison
- Bottleneck dimension sweep (4, 8, 16, 32)
- Activation comparison: ReLU, Tanh, ELU, SELU, LeakyReLU
- Loss strategies: standard MSE vs. mixed loss
- Optimizers: Adam, AdamW, SGD
- Thresholding: Percentile-based, F1-maximization

üìä **Best AE Result**  
F1 = 0.7527 | AUC = 0.9907 (Shallow AE, tanh, bottleneck=16, AdamW)

### ‚úÖ Variational AutoEncoder (VAE)

- Basic VAE
- KL divergence weighting (`Œ≤`-VAE)
- KL annealing (warm-up strategy)

‚ùå Paused further optimization on the VAE series because they underperformed compared to AE on this dataset

### üÜö Traditional Models

- One-Class SVM, Isolation Forest, Local Outlier Factor, Elliptic Envelope
- Trained on **normal-only samples**, validated on mixed data
- AE consistently outperformed all classical methods in F1/AUC

---
## üîç SHAP Interpretability

To better understand the behavior of the trained AutoEncoder (AE) model, I employed **SHAP (SHapley Additive exPlanations)** to provide insights into which input features most influence anomaly scores.

### ‚ùì Why SHAP?

SHAP is a unified approach to explain the output of any machine learning model. It computes the contribution of each feature by considering all possible combinations of features. In the context of anomaly detection, this allows us to:

- Identify which features contribute most to reconstruction errors
- Investigate what drives anomalous vs. normal behavior
- Build trust and transparency into the model‚Äôs decisions

### üìà Summary Plot

The SHAP summary plot ranks features by average impact and shows how high/low values of each feature affect anomaly detection. Here is the summary plot for our final selected AE model:![](images/SHAP_sum_plot.png)


### Workflow

- A subset of **anomalous** samples was selected for explanation
- SHAP values were computed using a background sample from normal data
- We visualized global importance using summary and bar plots

SHAP results demonstrated the AE model's ability to focus on semantically meaningful indicators of attack behavior.

> üìÅ For detailed SHAP plots and explanation workflow, see `notebooks/Shap_Interpretability.ipynb`.

## üèÅ Final Results: AE vs Traditional Methods

After a series of architectural, training, and loss function optimizations, the final AutoEncoder (AE) model was selected based on its balanced performance across precision, recall, and F1 score.

### üìä Final AE Performance
| Metric        | Value     |
|---------------|-----------|
| Precision     | 0.60896   |
| Recall        | 0.98529   |
| F1 Score      | 0.75271   |
| ROC AUC       | 0.99079   |
| TP / FP / TN / FN | 2814 / 1807 / 123495 / 42 |

### üß™ Traditional Methods Performance Comparison

| Method              | Precision | Recall  | F1 Score | ROC AUC | Notes |
|---------------------|-----------|---------|----------|---------|-------|
| **One-Class SVM**   | 0.55390   | 0.54517 | 0.54950  | 0.76758 | Tuned with GridSearch |
| **Isolation Forest**| 0.32598   | 0.21218 | 0.25705  | 0.60109 | Weak performance overall |
| **Elliptic Envelope** | 0.43888 | 0.34069 | 0.38360  | 0.66538 | Assumes Gaussian |
| **Local Outlier Factor** | 0.55393 | 0.54307 | 0.54844 | 0.76655 | Unsupervised fit on normal only |

The AE model **outperforms all traditional models** across all major metrics.

## üî≠ Future Work

This project lays a strong foundation for applying Autoencoder (AE) and Variational Autoencoder (VAE) models to network anomaly detection. Based on current results and limitations, several future directions are planned:

- **Custom Loss Functions**: Explore more advanced loss functions such as perceptual loss or feature-level reconstruction to better capture anomaly structure.
- **Model Fusion**: Investigate the combination of AE/VAE outputs with traditional anomaly detection scores (e.g., One-Class SVM) using ensemble techniques.
- **Generalization to Other Datasets**: Validate the current model pipeline on diverse cybersecurity datasets (e.g., CICIDS2017, NSL-KDD).
- **Online or Continual Learning**: Extend the AE/VAE to adapt in real-time or on streaming network traffic.
- **Time-Series Modeling**: Incorporate sequential architectures like LSTM-AE or Transformer-based VAE for traffic behavior modeling.
- **End-to-End Deployment**: Design a lightweight model variant suitable for deployment in real-time intrusion detection systems (IDS).

These directions aim to improve performance, robustness, interpretability, and deployment-readiness of deep anomaly detection models in real-world security settings.

---

## üë©‚Äçüíª Author

Created by [Shiyu Cai] ¬∑ Portfolio Project  
> *Feel free to fork, study or reuse parts of this repo in your own data science learning path.*